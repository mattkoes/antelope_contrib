.TH batch_dbevproc 1
.SH NAME
batch_dbevproc \- wrapper for dbevproc execution via cron job 
.SH SYNOPSIS
.nf
\fBbatch_dbevproc\fP [-v] [-V] [-l lddate_lagdays] [-p dbevprocpf] [-s origin_subset_expression] [-t tmpdir] db
.fi
.SH SUPPORT
.br
Contributed: NO BRTT support -- please contact author.
.SH DESCRIPTION
\fBbatch_dbevproc\fP is intended to be run as a cron job or \fIend-of-day\fP job to
calculate magnitudes across an entire database.  The motivation was to lower analyst 
frustration when having to wait for a magnitude to calculate after reviewing an event.
.br
The script reviews the database for all origins that have no netmag records
and attempts to calculate magnitudes based on the modules specified in the available
\fIdbevproc.pf\fP file.  Additional subsets can be applied to reduce the number
of origins reviewed.
.SH OPTIONS
.IP -v
Verbose output.  This will also toggle the verobse output to the \fBdbevproc\fP program.
.IP -V
Very verbose output, useful only for debugging.
.IP "-l days"
Lag time in days before calculating magnitudes.  If not specified, all orids matching the \fI-s origin_subset\fP
and the \fIauth_accept\fP in \fIdbevproc.pf\fP have magnitudes calculated.
.IP "-p parameter_file"
Alternate dbevproc parameter file to use.  The default parameter file name is \fBdbevproc.pf\fP.
.IP "-s origin_subset_expression"
Subset to apply to the origin table.  Example:  -s "lddate>='1/1/2011'&&auth=~/UCSD.*/".
.IP "-t tmpdir"
Directory where temporary database for \fBdbevproc\fP execution is saved.  If not specified
the output directory /fI./tmp_dbevproc/fP will be used. The output
database is called nomags. 
.IP db
Database which contains the origin, assoc, arrival, netmag, site, and wfdisc
tables.  If no netmag table is available, it will be generated by \fBdbevproc\fP.
.SH ENVIRONMENT
Need to have sourced $ANTELOPE/setup.csh and environment variable $PFPATH set.
.SH PARAMETER FILE
There is no specific parameter file for \fBbatch_dbevproc\fR but the \fBdbevproc\fR 
parameter file is used.  
.SH EXAMPLE
.LP Calculate magnitudes for all origins with an author of ANF.* and modified more
recently than 1 January 2001. 
.in 2c
.ft CW
.nf

%\fB batch_dbevproc -v -s "origin.auth=~/ANF.*/&&lddate>='1/1/2011'" db/usarray \fP

.fi
.ft R
.in

.LP Run as a nightly cronjob on all reviewed events.  The following line would be 
added to the crontab section of rtexec.pf
.in 2c
.ft CW
.nf

\fB batchmags UTC 0 13  * * *  batch_dbevproc -s "review=='y'" $DB \fP

.fi
.ft R
.in

.SH RETURN VALUES 
0 if success, 1 if no.
.SH "SEE ALSO"
.nf
\fBdbevprod\fR
.fi
.SH "BUGS AND CAVEATS"
.LP
Remember to verify which dbevproc.pf is in use and that the parameters for calculating
magnitudes (i.e. sta_expr and auth_accept) and output magnitude picks via orbwfmeas are
what you want them to be.
.LP
If you choose to run this as a cron job via your rtexec.pf, you should probably make 
sure that it does not run at the same time as \fBrtbackup\fP and \fBrtdbclean\fP.
.SH AUTHOR
Jennifer Eakins
.br
Univ. of California, San Diego

